use aiken/cbor
use cardano/address.{from_script}
use cocktail.{convert_int_to_bytes}
use mocktail.{mock_policy_id, mock_pub_key_hash, mock_script_hash}
use types.{CounterDatum, MemberDatum, OracleDatum, ProposalDatum}

pub const mock_first_admin = mock_pub_key_hash(0)

pub const mock_second_admin = mock_pub_key_hash(1)

pub const mock_third_admin = mock_pub_key_hash(2)

pub const mock_admins = [mock_first_admin, mock_second_admin, mock_third_admin]

pub const mock_admin_tenure = "11-11-1111"

pub const mock_multisig_threshold = 2

pub const mock_oracle_nft = mock_policy_id(0)

pub const mock_counter_nft = mock_policy_id(1)

pub const mock_membership_intent_token = mock_policy_id(2)

pub const mock_member_token = mock_policy_id(3)

pub const mock_propose_intent_token = mock_policy_id(4)

pub const mock_proposal_token = mock_policy_id(5)

pub const mock_sign_off_approval_token = mock_policy_id(6)

pub const mock_oracle_address = from_script("oracle_address")

pub const mock_counter_address = from_script("counter_address")

pub const mock_membership_intent_address =
  from_script("membership_intent_address")

pub const mock_member_address = from_script("member_address")

pub const mock_propose_intent_address = from_script("propose_intent_address")

pub const mock_proposal_address = from_script("proposal_address")

pub const mock_sign_off_approval_address =
  from_script("sign_off_approval_address")

pub const mock_treasury_address = from_script("treasury_address")

pub const mock_treasury_withdrawal_script_hash = mock_script_hash(700)

pub const mock_input_oracle_datum: OracleDatum =
  OracleDatum {
    admins: mock_admins,
    admin_tenure: mock_admin_tenure,
    multi_sig_threshold: mock_multisig_threshold,
    oracle_nft: mock_oracle_nft,
    oracle_address: mock_oracle_address,
    counter_nft: mock_counter_nft,
    counter_address: mock_counter_address,
    membership_intent_token: mock_membership_intent_token,
    memebership_intent_address: mock_membership_intent_address,
    member_token: mock_member_token,
    member_address: mock_member_address,
    propose_intent_token: mock_propose_intent_token,
    propose_intent_address: mock_propose_intent_address,
    proposal_token: mock_proposal_token,
    proposal_address: mock_proposal_address,
    sign_off_approval_token: mock_sign_off_approval_token,
    sign_off_approval_address: mock_sign_off_approval_address,
    treasury_address: mock_treasury_address,
    treasury_withdrawal_script_hash: mock_treasury_withdrawal_script_hash,
  }

pub const mock_new_first_admin = mock_pub_key_hash(10)

pub const mock_new_second_admin = mock_pub_key_hash(11)

pub const mock_new_third_admin = mock_pub_key_hash(12)

pub const mock_new_admins =
  [mock_new_first_admin, mock_new_second_admin, mock_new_third_admin]

pub const mock_new_multisig_threshold = 1

pub const mock_new_admin_tenure = "22-22-2222"

pub const mock_counter_input_datum = CounterDatum { count: 2 }

pub const mock_counter_count = "2"

pub const mock_user_token = (mock_policy_id(20), "user_token")

pub const mock_user_address = from_script("user_address")

pub const mock_metadata = "abc project"

pub const mock_fund_requested = 1000

pub const mock_member = 2

pub const mock_receiver = from_script("receiver")

pub const mock_member_datum =
  MemberDatum {
    token: (mock_user_token.1st, mock_user_token.2nd),
    completion: [],
    fund_recevied: 0,
    metadata: mock_metadata,
  }

pub const mock_proposal_datum =
  ProposalDatum {
    fund_requested: mock_fund_requested,
    receiver: mock_receiver,
    member: mock_member,
    metadata: mock_metadata,
  }

test gg() {
  let a = 0
  let b = convert_int_to_bytes(a)

  (b == "30")?
}

test test_datum_p() {
  let data =
    #"d8799f1a05f5e100d8799fd8799f581cab44f916e940ef5233582b9e901359c806374a644b2a5a404171d589ffd8799fd8799fd8799f581c8dabad4a2faaa2c13312f16f0feb3af58b47025b717ac059f555648bffffffff00d8799f5650726f746f636f6c204d696e6f722056657273696f6e9f58202a2a2a5468652043617264616e6f20626c6f636b636861696e20686173206f765820657220343020706172616d65746572732e2a2a2a205c0a5468657365207061725820616d6574657273206c65742074686520636f6d6d756e6974792061646a757374582020746f207468652073797374656d20746f206368616e67696e6720746563686e58206f6c6f677920616e642065636f73797374656d206e656564732e20496e206120582070726576696f75732061727469636c6520776520636f7665726564207468652058205b70726f746f636f6c5f6d616a6f725d2868747470733a2f2f7777772e6c696458206f6e6174696f6e2e636f6d2f656e2f706f7374732f70726f746f636f6c2d6d6158206a6f722d76657273696f6e2f29202c2074686520706172656e7420706172616d582065746572206f6620736f727420746f206f757220706172616d65746572206f66582020746865206461792e20546f6461792077652077696c6c206265206c6f6f6b6958206e67206174207468652070726f746f636f6c5f6d696e6f722e2023232057686158207420697320612050726f746f636f6c204d696e6f7220506172616d657465723f5820205468652043617264616e6f2070726f746f636f6c20697320616e2061627374582072616374696f6e2061726f756e64206d616e7920286e6f7420616c6c29206f665820207468652072756c657320746861742074686174206e6f64657320696e207468582065206e6574776f726b20616772656520746f20666f6c6c6f772e205665727369546f6e696e672e2e2e0a0a476f7665726e616e6365ff433130309f5820616464725f7465737431717a34356637676b613971773735336e7471346561795820716e74387971766436327633396a356b6a7167396361747a766434776b353574582061323574716e78796833647538376b77683433647273796b6d33307471396e614c3234766a39733575336d3866ff9f5820616464725f7465737431717a34356637676b613971773735336e7471346561795820716e74387971766436327633396a356b6a7167396361747a766434776b353574582061323574716e78796833647538376b77683433647273796b6d33307471396e614c3234766a39733575336d3866ff4770656e64696e67ffff"

  expect Some(proposal) = cbor.deserialise(data)
  expect p: ProposalDatum = proposal
  p.fund_requested == 100000000
}

test test_datum_m() {
  let data =
    #"d8799f9f581cc76c35088ac826c8a0e6947c8ff78d8d4495789bc729419b3a3343054b3232326667647373535353ffa000d8799fd8799fd8799f581cab44f916e940ef5233582b9e901359c806374a644b2a5a404171d589ffd8799fd8799fd8799f581c8dabad4a2faaa2c13312f16f0feb3af58b47025b717ac059f555648bffffffff4d57796e7465722047726168616d54526174696f6e652076656c6974207175697320715672697a656b7572406d61696c696e61746f722e636f6d53457374206572726f7220736564206561206578424b45474d6f6d62617361ffff"

  expect Some(member) = cbor.deserialise(data)
  expect m: MemberDatum = member
  m.completion == []
}

test test_datum_o() {
  let data =
    #"d8799f9f581c62bf3aaffe8fa1f9234eebbf929fadc1578953512d0702f3a4c75fd3581ceefc003a4f060ed3248086618042734b2af45239a565fc4d66aaa865581cf9de2526ed608b49c9c4e1d8e53cd21cb0606f4f902d78a91043ddddff42317901581c18335b8db6b15a90c8381afd20a415f7b335e8c195f105dfac9f2b6fd8799fd87a9f581c56ec5d32ef43cb7051b2b7d9425cd471435d511b140c58582c5f1f79ffd87a80ff581c67142350ec10d010ab2ae17d45e15825856586089f82e61c2417a61cd8799fd87a9f581cb86fa66f980afa0c71b9b4e7ff40e98d11d85f56eec9f11bead9605dffd87a80ff581c02e7ab63d0c8de8b79f3148e5913ecb531cd900068ce188f68219056d8799fd87a9f581c7d3fe580affc19cbb8061ebacdf50ebcc3b17b60b4335ce855bd58f9ffd87a80ff581cd13c75c6fdd6480ec1d0b1dcb41a634fb2d236a7074dcebb7f9f200dd8799fd87a9f581c04d6c98e05606e4ea7588e924d7925a6a4e4e768e06115801506a13effd87a80ff581ca8ba36f20bfb4594c30907028b1b3990389627b9cdbe123041482ce5d8799fd87a9f581cda815a86d8f70d38ad18b1b10442f8c249929563899a9a5086661eeeffd87a80ff581c96ee753a0cd43974d6f429ce1219fabe3f1f81a4717ed1d2e57a8f4ad8799fd87a9f581c0505c9dd1d4628540781dfcf13bbc231454c59b92ecf1b5b24f7966affd87a80ff581c40e0d0bbb8241e161f1023647c21b49d40ecee845b794e19a417456ed8799fd87a9f581cd33a78cd22a38a1b32caeed6197236c1905e2b7d3fe1c29b18ecc845ffd87a80ffd8799fd87a9f581ca92cee38c88df651f0a5d7e04cefc3cddb5b9e16db4370876848a47bffd87a80ff581c1e8a03e80431773ffba59f8f517da4b4253da11ded8aacd496ce2e2fff"

  expect Some(oracle) = cbor.deserialise(data)
  expect o: OracleDatum = oracle
  o.treasury_withdrawal_script_hash == #"1e8a03e80431773ffba59f8f517da4b4253da11ded8aacd496ce2e2f"
}

test test_datum_m_output() {
  let data =
    #"d8799f9f581cc76c35088ac826c8a0e6947c8ff78d8d4495789bc729419b3a3343054b3232326667647373535353ffa1d8799f5650726f746f636f6c204d696e6f722056657273696f6e9f5820326132613261353436383635323034333631373236343631366536663230363258203663366636333662363336383631363936653230363836313733323036663736582036353732323033343330323037303631373236313664363537343635373237335820326532613261326132303563306135343638363537333635323037303631373258203631366436353734363537323733323036633635373432303734363836353230582036333666366436643735366536393734373932303631363436613735373337345820323037343666323037343638363532303733373937333734363536643230373458203666323036333638363136653637363936653637323037343635363336383665582036663663366636373739323036313665363432303635363336663733373937335820373436353664323036653635363536343733326532303439366532303631323058203730373236353736363936663735373332303631373237343639363336633635582032303737363532303633366637363635373236353634323037343638363532305820356237303732366637343666363336663663356636643631366136663732356458203238363837343734373037333361326632663737373737373265366336393634582036663665363137343639366636653265363336663664326636353665326637305820366637333734373332663730373236663734366636333666366332643664363158203661366637323264373636353732373336393666366532663239323032633230582037343638363532303730363137323635366537343230373036313732363136645820363537343635373232303666363632303733366637323734323037343666323058203666373537323230373036313732363136643635373436353732323036663636582032303734363836353230363436313739326532303534366636343631373932305820373736353230373736393663366332303632363532303663366636663662363958203665363732303631373432303734363836353230373037323666373436663633582036663663356636643639366536663732326532303233323332303537363836315820373432303639373332303631323035303732366637343666363336663663323058203464363936653666373232303530363137323631366436353734363537323366582032303534363836353230343336313732363436313665366632303730373236665820373436663633366636633230363937333230363136653230363136323733373458203732363136333734363936663665323036313732366637353665363432303664582036313665373932303238366536663734323036313663366332393230366636365820323037343638363532303732373536633635373332303734363836313734323058203734363836313734323036653666363436353733323036393665323037343638582036353230366536353734373736663732366232303631363737323635363532305820373436663230363636663663366336663737326532303536363537323733363958203666366536393665363732653265326530613061343736663736363537323665483631366536333635ff433130309f5820363136343634373235663734363537333734333137313761333433353636333758203637366236313339373137373337333533333665373437313334363536313739582037313665373433383739373137363634333633323736333333393661333536625820366137313637333936333631373437613736363433343737366233353335373458203631333233353734373136653738373936383333363437353338333736623737582036383334333336343732373337393662366433333330373437313339366536315818333233343736366133393733333537353333366433383636ff9f5820363136343634373235663734363537333734333137313761333433353636333758203637366236313339373137373337333533333665373437313334363536313739582037313665373433383739373137363634333633323736333333393661333536625820366137313637333936333631373437613736363433343737366233353335373458203631333233353734373136653738373936383333363437353338333736623737582036383334333336343732373337393662366433333330373437313339366536315818333233343736366133393733333537353333366433383636ff4770656e64696e67ff1a05f5e1001a05f5e100d8799fd8799fd8799f581cab44f916e940ef5233582b9e901359c806374a644b2a5a404171d589ffd8799fd8799fd8799f581c8dabad4a2faaa2c13312f16f0feb3af58b47025b717ac059f555648bffffffff4d57796e7465722047726168616d54526174696f6e652076656c6974207175697320715672697a656b7572406d61696c696e61746f722e636f6d53457374206572726f7220736564206561206578424b45474d6f6d62617361ffff82581d70a92cee38c88df651f0a5d7e04cefc3cddb5b9e16db4370876848a47b1a35a4e9008258390008d9d743d6ee8cbec90836b8eb7a0563698a0d2a3b154cbad9ca13467c16240714ea0e12b41a914f2945784ac494bb19573f0ca61a08afa81a0c651b6e021bffffffffffffffff"

  expect Some(member) = cbor.deserialise(data)
  expect m: MemberDatum = member
  m.completion != []
}
